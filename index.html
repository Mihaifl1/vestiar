<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vestiar – uși cu poziții din cod</title>
<style>
  :root{
    --bg:#0b1220; --wall:#e5e7eb;
    --closed:#22c55e;  /* verde = ÎNCHIS  */
    --open:#ef4444;    /* roșu  = DESCHIS */
    --nopower:#6b7280; --hinge:#94a3b8;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#fff;font-family:Arial,Helvetica,sans-serif}
  .wrap{max-width:2000px;margin:0 auto;padding:16px}
  h1{font-size:20px;margin:0 0 10px}

  .legend{font-size:14px;opacity:.9;margin-bottom:10px}
  .legend span{display:inline-block;margin-right:8px;padding:2px 8px;border-radius:6px}
  .legend .c{background:var(--closed)}
  .legend .o{background:var(--open)}
  .legend .p{background:var(--nopower)}

  .plan{
    position:relative;width:100%;
    aspect-ratio: 4 / 2.2;
    background:#0f172a url("vestiar.jpg") center/cover no-repeat;
    border:10px solid var(--wall);border-radius:12px;overflow:hidden;
    user-select:none;
  }

  /* Ușa = grup transformat (translate+rotate) – doar vizualizare, fără drag */
  .door{
    position:absolute; left:0; top:0;
    --x: 0%; --y: 0%; --a: 0;           /* variabile controlate din JS */
    transform: translate(var(--x), var(--y)) rotate(calc(var(--a) * 1deg));
    transform-origin: 0 0;
    width: 84px; height: 44px;
    cursor:pointer;
  }
  .door .hinge{
    position:absolute; top:12px; width:8px; height:20px;
    background:var(--hinge); border-radius:4px;
  }
  .door .leaf{
    position:absolute; top:8px; width:72px; height:28px;
    border:2px solid #000; border-radius:6px; background:var(--closed);
    transition: transform .3s ease, background .2s ease, box-shadow .2s ease;
    transform-origin: left center; box-shadow:0 0 0 rgba(0,0,0,0);
  }
  .door .label{
    position:absolute; left:0; top:-14px; font-size:12px; font-weight:bold;
    text-shadow:0 1px 2px rgba(0,0,0,.5)
  }

  /* Balamaua controlează poziția elementelor în grup */
  .door[data-hinge="left"] .hinge{ left:-6px }
  .door[data-hinge="right"] .hinge{ right:-6px }
  .door[data-hinge="left"]  .leaf{ left:0;  transform-origin:left  center }
  .door[data-hinge="right"] .leaf{ right:0; transform-origin:right center }

  /* DESCHIS = rotație în afară față de balama */
  .door[data-hinge="left"].open  .leaf{ transform: rotate(92deg);  background:var(--open);  box-shadow:0 6px 10px rgba(0,0,0,.45) }
  .door[data-hinge="right"].open .leaf{ transform: rotate(-92deg); background:var(--open);  box-shadow:0 6px 10px rgba(0,0,0,.45) }
  .door.nopower .leaf{ background:var(--nopower) }
</style>
</head>
<body>
<div class="wrap">
  <h1>Vestiar – poziții setate din cod (fără editare în UI)</h1>
  <div class="legend">
    <span class="c">ÎNCHIS (verde)</span>
    <span class="o">DESCHIS (roșu)</span>
    <span class="p">Fără alimentare (gri)</span>
    <span style="opacity:.8;margin-left:8px">Click = comută, Shift+Click = fără alimentare</span>
  </div>

  <div class="plan" id="plan">
    <!-- Uși (ID-urile rămân fixe; pozițiile vin din CONFIG) -->
    <div class="door" id="d1" data-hinge="left"><div class="hinge"></div><div class="leaf"></div><div class="label">Ușa 1</div></div>
    <div class="door" id="d2" data-hinge="left"><div class="hinge"></div><div class="leaf"></div><div class="label">Ușa 2</div></div>
    <div class="door" id="d3" data-hinge="left"><div class="hinge"></div><div class="leaf"></div><div class="label">Ușa 3</div></div>
    <div class="door" id="d4" data-hinge="right"><div class="hinge"></div><div class="leaf"></div><div class="label">Ușa 4</div></div>
    <div class="door" id="d5" data-hinge="right"><div class="hinge"></div><div class="leaf"></div><div class="label">Ușa 5</div></div>
    <div class="door" id="d6" data-hinge="right"><div class="hinge"></div><div class="leaf"></div><div class="label">Ușa 6</div></div>
  </div>
</div>

<script>
/* =======================
   1) CONFIG – MODIFICĂ AICI
   x, y = procente din lățimea/înălțimea planului (0–100)
   a    = unghi (grade), 0 = ușa „aliniată” cu desenul
   hinge = 'left' | 'right' (partea balamalei)
======================= */
const CONFIG = {
  d1: { x:  47,  y: 80, a:   0, hinge:'left'  },
  d2: { x:  200,  y: 34, a:   0, hinge:'left'  },
  d3: { x:  2,  y: 56, a:   0, hinge:'left'  },
  d4: { x: 92,  y: 20, a: 180, hinge:'right' },
  d5: { x: 92,  y: 45, a: 180, hinge:'right' },
  d6: { x: 92,  y: 70, a: 180, hinge:'right' }
};
/* ======================= */

/* Starea ușilor (pentru click) */
const state = {}; // id -> 'LOCKED' | 'UNLOCKED' | 'NOPOWER'

function setDoorState(id, st){
  state[id] = st;
  const el = document.getElementById(id);
  if(!el) return;
  el.classList.toggle('open', st==='UNLOCKED');
  el.classList.toggle('nopower', st==='NOPOWER');
}

/* Aplică pozițiile din CONFIG la încărcare */
function applyConfig(){
  Object.keys(CONFIG).forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    const {x,y,a,hinge} = CONFIG[id];
    el.style.setProperty('--x', (x||0) + '%');
    el.style.setProperty('--y', (y||0) + '%');
    el.style.setProperty('--a', (a||0));
    if(hinge) el.dataset.hinge = hinge;
    state[id] = state[id] || 'LOCKED'; // implicit închis (verde)
  });
}

/* Click: comută verde/roșu; Shift+Click: gri */
document.querySelectorAll('.door').forEach(el=>{
  el.addEventListener('click', (e)=>{
    const id = el.id;
    if(e.shiftKey){ setDoorState(id,'NOPOWER'); return; }
    setDoorState(id, state[id]==='LOCKED' ? 'UNLOCKED' : 'LOCKED');
  });
});

/* Inițializează */
applyConfig();

/* ===== MQTT (opțional) =====
   - decomentează scriptul mqtt.min.js în <head> și adaugă logica de mai jos.
   - la primirea statusului: setDoorState('d1','LOCKED'|'UNLOCKED'|'NOPOWER')
*/

/* Exemplu:
const client = mqtt.connect("wss://broker.emqx.io:8084/mqtt", {clientId:"web_"+Math.random().toString(16).slice(2)});
const map = {
  d1:{status:"locker/1/status", cmd:"locker/1/cmd"},
  d2:{status:"locker/2/status", cmd:"locker/2/cmd"},
  d3:{status:"locker/3/status", cmd:"locker/3/cmd"},
  d4:{status:"locker/4/status", cmd:"locker/4/cmd"},
  d5:{status:"locker/5/status", cmd:"locker/5/cmd"},
  d6:{status:"locker/6/status", cmd:"locker/6/cmd"}
};
client.on("connect",()=>{ Object.values(map).forEach(ch=> client.subscribe(ch.status)); });
client.on("message",(t,m)=>{
  const s = m.toString(); // 'LOCKED' | 'UNLOCKED' | 'NOPOWER'
  for(const id in map) if(map[id].status===t) setDoorState(id, s);
});
// la click poți publica (după setDoorState):
// client.publish(map[id].cmd, state[id]==='LOCKED' ? 'UNLOCK' : 'LOCK');
*/
</script>
</body>
</html>


